# # ---------------
# # search_system
# # ---------------
services:
  # For custome purpose
  mysql_db:
    extends:
      file: ../../platform/docker-compose.base.yml
      service: mysql_db
    volumes:
      - ./sql:/docker-entrypoint-initdb.d       # âœ… project-specific init.sql
      - ./volumes/mysql_data:/var/lib/mysql
    profiles: 
       - search
      
  elasticsearch:
    extends:
      file: ../../platform/docker-compose.base.yml
      service: elasticsearch
    volumes:
      - ./volumes/es_data:/usr/share/elasticsearch/data
    profiles: 
       - search
       
  fastapi_search_service:
    extends:
      file: ../../platform/docker-compose.base.yml
      service: fastapi_search_service
    build:
      context: ../..                                # repo root
      dockerfile: platform/search_system/FastAPI_service/Dockerfile
      args:
        PROJECT_CODE_PATH: projects/arxiv_lakehouse/search_system_code
    volumes:
      - ./search_system_code:/app  # Persistent data storage for FastAPI
    profiles: 
       - search


  # --------------------
  # MinIO for object storage
  # --------------------
  minio:
    extends:
      file: ../../platform/docker-compose.base.yml
      service: minio
    volumes:
      - ./volumes/minio-data:/data
    profiles: 
       - storage

  createbucket:
    extends:
      file: ../../platform/docker-compose.base.yml
      service: createbucket
    profiles:
      - storage

  # --------------------
  # Spark Cluster
  # --------------------
  spark-master:
    extends:
      file: ../../platform/docker-compose.base.yml
      service: spark-master
    build:
      context: ../..
      dockerfile: platform/spark_jobs/Dockerfile
      args:
        PROJECT_CODE_PATH: projects/arxiv_lakehouse/spark_jobs
    # volumes:
    #   - ./volumes/spark_volume/jupyterlab:/home/jovyan/work/jupyter # For jupyterlab to test spark
    profiles:
      - spark

  spark-worker-1:
    extends:
      file: ../../platform/docker-compose.base.yml
      service: spark-worker-1
    build:
      context: ../..
      dockerfile: platform/spark_jobs/Dockerfile
      args:
        PROJECT_CODE_PATH: projects/arxiv_lakehouse/spark_jobs
    # volumes:
    #   - ./volumes/spark_volume/jupyterlab:/home/jovyan/work/jupyter # For jupyterlab to test spark
    profiles:
      - spark

  spark-worker-2:
    extends:
      file: ../../platform/docker-compose.base.yml
      service: spark-worker-2
    build:
      context: ../..
      dockerfile: platform/spark_jobs/Dockerfile
      args:
        PROJECT_CODE_PATH: projects/arxiv_lakehouse/spark_jobs
    # volumes:
    #   - ./volumes/spark_volume/jupyterlab:/home/jovyan/work/jupyter # For jupyterlab to test spark
    profiles:
      - spark

  # jupyter:
  #   extends:
  #     file: ../../platform/docker-compose.base.yml
  #     service: jupyter
  #   build:
  #     context: ../..
  #     dockerfile: platform/spark_jobs/Dockerfile
  #     args:
  #       PROJECT_CODE_PATH: projects/arxiv_lakehouse/spark_jobs
  #   volumes:
  #     - ./volumes/spark_volume/jupyterlab:/home/jovyan/work/jupyter
  #   profiles:
  #     - spark


# volumes:
#   mysql_data:
#     external: true

networks:
  bigdata-net:
    external: true

